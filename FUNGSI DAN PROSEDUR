#include<Python3.h>
import csv

dataBase = []

def setDatabase(fileName):
	file = open(fileName, "r")

	for lines in file:
		line = lines[:len(lines)-1]     #menghilangkan newLine "\n" dari setiap baris
		line += ","     #Pembatas data terakhir.

		dataLine = []
		data = ""
		for i in range(len(line)):
			if (line[i] != ","):
				data += line[i]
			else:
				dataLine.append(data)
				data = ""

		dataBase.append(dataLine)

#Load file User
setDatabase("User.csv")




# Fungsi Jafar
#Fungsi menghitung panjang kolom / menghitung banyaknya kolom
def column_length(arr_data):
    panjang = 0
    for i in arr_data[0]:
        panjang += 1
    return panjang

    
#Fungsi untuk menghitung panjang baris
def row_length(array_data):    
    jml_baris = 0
    idx_baris = 0
    for row in array_data:
        if array_data[idx_baris][0] == '': #jika di kolom pertama sudah menemukan default value maka terdeteksi bukan data
            break
        jml_baris += 1
        idx_baris += 1
    return jml_baris
    
#fungsi untuk memasukan data csv ke array
def load(arrData, csv_file_path): 
    with open(csv_file_path, 'r') as csv_file:
        csv_reader = csv.reader(csv_file)
        for row in csv_reader:
            temp_array = row #temp_array adalah satu array yang berisi satu baris data pada csv
            idx_baris = row_length(arrData) #ambil indeks yang masih kosong
            for kolom in range(column_length(arrData)):
                arrData[idx_baris][kolom] = temp_array[kolom]

#fungsi untuk membuat file beserta dengan headernya, dibuat hanya jika file belum ada
def create_file(csv_file_path):
    with open(csv_file_path, 'w', newline="") as csv_file:
        writer = csv.writer(csv_file)
        if csv_file_path == ('user.csv'):
            writer.writerow(['Nama', 'Tanggal_Lahir','Tinggi_Badan', 'Username', 'Password', 'Role', 'Saldo'])
            writer.writerow(['admin', '00/00/0000', '0', 'admin', 'password', 'admin', '0']) #ini akun untuk admin
        elif csv_file_path == 'wahana.csv':
            writer.writerow(['ID_Wahana', 'Nama_Wahana','Harga_Tiket', 'Batasan_Umur', 'Batasan_Tinggi'])
        elif csv_file_path == 'pembelian.csv':
            writer.writerow(['Username', 'Tanggal_Pembelian', 'ID_Wahana', 'Jumlah_Tiket'])
        elif csv_file_path == 'penggunaan.csv':
            writer.writerow(['Username', 'Tanggal_Penggunaan', 'ID_Wahana', 'Jumlah_Tiket'])
        elif csv_file_path == 'tiket.csv':
            writer.writerow(['Username', 'ID_Wahana', 'Jumlah_Tiket'])
        elif csv_file_path == 'refund.csv':
            writer.writerow(['Username', 'Tanggal_Refund', 'ID_Wahana', 'Jumlah_Tiket'])
        elif csv_file_path == 'kritiksaran.csv':
            writer.writerow(['Username', 'Tanggal_Kritik', 'ID_Wahana', 'Isi_Kritik'])

#fungsi untuk memasukkan array ke csv
def save_file(arr_data, csv_file_path):
    with open(csv_file_path, 'w', newline='') as csv_file:
        writer = csv.writer(csv_file)
        for i in range(row_length(arr_data)):
            writer.writerow(arr_data[i])
	
	
def cari_pemain(arr_data): #array yang dimasukkan adalah array user
    found = False
    pemain = input("Masukkan username : ")
    for baris in range (row_length(arr_data)):
        if arr_data[baris][3] == pemain:
            print('Nama Pemain :', arr_data[baris][0])
            print('Tinggi Pemain :', arr_data[baris][2], 'cm')
            print("Tanggal lahir pemain :", arr_data[baris][1])
            found = True
            break
    if not found:
        print("Username tidak ditemukan, periksa kembali penulisan username / username tidak ada pada sistem kami")


#prosedur untuk menangani pembuatan file baru atau laod file yang sudah ada
def start_file(arr_data, csv_file_name):
    try:
        load(arr_data, csv_file_name)
    except FileNotFoundError:
        create_file(csv_file_name)
        load(arr_data, csv_file_name)


#Prosedur beli tiket
def beli_tiket(username, arr_data_beli, arr_data_user, arr_data_wahana, arr_data_tiket):
    ID_Wahana = input("Masukkan ID wahana : ") #asumsi user selalu menginput hal yang benar
    tanggal = input("Masukkan tanggal hari ini : {format (DD/MM/YYYY)}") #asumsi input user selalu benar
    tahun_beli = int(tanggal[6:]) #dapatkan tahun pembelian
    jumlah_tiket = int(input("Jumlah tiket yang dibeli : "))

    #dapatkan tanggal lahir,tinggi_badan, dan saldo username yang diakses dari array yang berisi file user.csv
    for idx_baris in range(row_length(arr_data_user)):
        if arr_data_user[idx_baris][3] == username:
            indeks = idx_baris
            Tinggi_Badan = int(arr_data_user[idx_baris][2])
            saldo = int(arr_data_user[idx_baris][6])
            #Proses untuk mendapatkan kategori umur user
            date_born = arr_data_user[idx_baris][1] #tanggal lahir user
            tahun_lahir_user = int(date_born[6:]) #dapatkan tahun lahir user
            break
            
    #dapatkan data id Wahana, harga tiket, batasan umur dan batasan tinggi badan dari array berisi file wahana.csv
    for idx_baris in range (row_length(arr_data_wahana)):
        if arr_data_wahana[idx_baris][0] == ID_Wahana:
            harga_tiket = int(arr_data_wahana[idx_baris][2]) #dapatkan dalam bentuk integer
            batasan_umur = arr_data_wahana[idx_baris][3]
            batasan_tinggi = arr_data_wahana[idx_baris][4]
            break

    #asumsi umur yang mendekati umur tersebut dibulatkan
    #misal usia anak-anak 12 tahun, tahun sekarang 2020, tahun lahir user 2008, maka akan digenapkan menjadi 12 tahun meskipun sebenarnya ia belum ulang tahun pada tahun tersebut
    umur_user = tahun_beli - tahun_lahir_user

    beli_sukses = False #tanda berhasil diproses atau tidak
    if batasan_umur == 'anak-anak' and umur_user <= 12:
        #pada wahana anak-anak tidak ada batas tinggi badan
        if saldo >= harga_tiket * jumlah_tiket:
            beli_sukses = True
            print("Selamat bersenang-senang di Almond’s Charm!", username)
        else: #saldo tidak cukup
            print("Saldo Anda tidak cukup"); print("Silakan mengisi saldo Anda")
    elif batasan_umur == 'dewasa' and umur_user >= 18:
        if batasan_tinggi == '>=170' and Tinggi_Badan >= 170:
            if saldo >= harga_tiket*jumlah_tiket:
                beli_sukses = True
                print("Selamat bersenang-senang di Almond’s Charm!", username)
            else: #saldo kurang
                print("Saldo Anda tidak cukup"); print("Silakan mengisi saldo Anda")
        elif batasan_tinggi == '>=170' and Tinggi_Badan < 170:
            print("Anda tidak memenuhi persyaratan untuk memainkan wahana ini."); print("Silakan menggunakan wahana lain yang tersedia.")
        elif batasan_tinggi == 'tanpa batasan':
            if saldo >= harga_tiket*jumlah_tiket:
                beli_sukses = True
                print("Selamat bersenang-senang di Almond’s Charm!", username)
            else: #saldo kurang
                print("Saldo Anda tidak cukup"); print("Silakan mengisi saldo Anda")
    elif batasan_umur == 'semua umur':
        if batasan_tinggi == '>=170' and Tinggi_Badan >= 170:
            if saldo >= harga_tiket*jumlah_tiket:
                beli_sukses = True
                print("Selamat bersenang-senang di Almond’s Charm!", username)
            else: #saldo kurang
                print("Saldo Anda tidak cukup"); print("Silakan mengisi saldo Anda")
        elif batasan_tinggi == '>=170' and Tinggi_Badan < 170:
            print("Anda tidak memenuhi persyaratan untuk memainkan wahana ini."); print("Silakan menggunakan wahana lain yang tersedia.")
        elif batasan_tinggi == 'tanpa batasan':
            if saldo >= harga_tiket*jumlah_tiket:
                beli_sukses = True
                print("Selamat bersenang-senang di Almond’s Charm!", username)
            else: #saldo kurang
                print("Saldo Anda tidak cukup"); print("Silakan mengisi saldo Anda")
    else: #tidak ada persyaratan yang memenuhi
        print("Anda tidak memenuhi persyaratan untuk memainkan wahana ini."); print("Silakan menggunakan wahana lain yang tersedia.")

    data_input = [username, tanggal, ID_Wahana, jumlah_tiket] #menampung data input user untuk dimasukkan ke array_data_beli
    
    if beli_sukses == True:
        arr_data_user[indeks][6] = (saldo - harga_tiket * jumlah_tiket) #update nilai saldo user pada array berisi saldo
        indeks_kosong = row_length(arr_data_beli) #dapatkan indeks yang masih kosong
        arr_data_beli[indeks_kosong] = data_input

        tiket_punya = False #False, artinya username belum punya tiket sebelumnya
        for baris in range (row_length(arr_data_tiket)): #cek apakah username sudah memiliki tiket di ID Wahana tersebut atau belum
            if arr_data_tiket[baris][0] == username and arr_data_tiket[baris][1] == ID_Wahana:
                arr_data_tiket[baris][2] = int(arr_data_tiket[baris][2]) + jumlah_tiket #update jumlah tiket dimiliki
                tiket_punya = True
                break
        if tiket_punya == False:
            data_tiket = [username, ID_Wahana, jumlah_tiket]
            idx_empty = row_length(arr_data_tiket) #dapatkan indeks yang masih kosong untuk diisi data
            arr_data_tiket[idx_empty] = data_tiket
            
#Tambahan prosedur untuk program utama
def show_load():
    user = input("Masukkan nama File User: ")
    wahana = input("Masukkan nama File Daftar Wahana: ")
    beli_tiket = input("Masukkan nama File Pembelian Tiket: ")
    penggunaan_tiket = input("Masukkan nama File Penggunaan Tiket: ")
    kepemilikan_tiket = input("Masukkan nama File Kepemilikan Tiket: ")
    refund = input("Masukkan nama File Refund Tiket: ")
    kritik = input("Masukkan nama File Kritik dan Saran: ")
    print()
    print('File perusahaan Willy Wangky’s Chocolate Factory telah di-load.')

def show_menu_player():
    print()
    batas = '='*30
    print(batas)
    print("1.Cari Wahana                 ||")
    print("2.Beli Tiket Wahana           ||")
    print("3.Main ke Wahana              ||")
    print("4.Refund Tiket                ||")
    print("5.Kotak Kritik dan Saran      ||")
    print("6.Exit                        ||")
    print(batas)
    
def show_menu_admin():
    print()
    batas = '='*30
    print("1.SignUp pemain")
    print('2.Cari pemain')
    print('3.Cari Wahana')
    print('4.Lihat Daftar Kritik dan Saran')
    print('5.Tambah Wahana Baru')
    print('6.TopUp saldo pemain')
    print('7.Lihat Riwayat Penggunaan Wahana')
    print('8.Lihat jumlah tiket pemain')
    print('9.Exit')
    batas = '='*30


#Endof Bagian Jafar










#Bagian Yudi

#Prosedur Penggunaan Tiket
def Use_Tiket (_username):

	nKepemilikanTiket = row_length(data_kepemilikan_tiket)

	nPenggunaanWahana = row_length(data_pengunaan_tiket)

	dataPenggunaan = ["" for i in range(4)]
	valid = False
	while(not valid and nKepemilikanTiket != 0):

		ID = input("Masukkan ID wahana : ")
		date = input("Masukkan tanggal hari ini : ")
		tickets = input("Jumlah tiket yang digunakan : ")

		for i in range(nKepemilikanTiket):
			if (data_kepemilikan_tiket[i][0] == _username):
				if (data_kepemilikan_tiket[i][1] == ID and data_kepemilikan_tiket[i][2] >= tickets and tickets != 0):
					valid = True		
					idx = i	

		if (not valid):
			print("\nTiket Anda tidak valid dalam sistem kami")
		else:
			print("\nTerima kasih telah bermain.")


	if (valid):
		dataPenggunaan[0] = _username
		dataPenggunaan[1] = date
		dataPenggunaan[2] = ID
		dataPenggunaan[3] = tickets

		data_kepemilikan_tiket[idx][2] = str(int(data_kepemilikan_tiket[idx][2]) - int(tickets))	#Pengurangan tiket
	
		data_penggunaan_wahana[nPenggunaanWahana] = dataPenggunaan





#End of bagian Yudi














#Bagian Karlsen

#fungsi login
def login(arr_data)
    login = False

    while login == False:
        
        username = input("Please enter your username: ")
        password = input("Please enter your password: ")

        col0 = [x[0] for x in array_user]
        col1 = [x[1] for x in array_user]

        if username in col0:
            for i in range(0, len(col0)):
                if col0[i] == username and col1[i] == password:
                    print("You are logged in")
                    login = True
		    return True

        else:
            print("Wrong username or password")
	    return False









#Endof bagian Karlsen




















#Bagian Bona
#fungsi untuk sign_up user baru oleh admin
def sign_up(arr_user) :
    nama = input("Masukkan nama pemain: ")
    tgl_lahir = input("Masukkan tanggal lahir pemain (DD/MM/YYYY): ")
    tinggi_badan = int(input("Masukkan tinggi badan pemain (cm): "))
    #Vallidasi username
    while (True) :
        new_username = input("Masukkan username pemain: ")
        found = False
        for baris in range (len(user_data)) :
            if (user_data[baris][3] == username) :
                found = True
                break
        if (not found) :
            break
        else :
            print ("username sudah dipakai, silahkan masukkan username lainnya!")

    password = input("Masukkan password pemain: ")
    role = "Pemain"
    saldo = 0
    #Terminasi
    new_data = [nama, tgl_lahir, tinggi_badan, new_username, password, role, saldo]
    arr_user.append(new_data)
    print("Selamat menjadi pemain, Willy Wangky. Selamat bermain.")
    return()

#fungsi refund tiket (pengembalian dana sebesar 75% dari harga tiket yang direfund)

def refund(username, tanggal, arr_tiket, arr_wahana, arr_user, arr_refund):
    #Asumsi ID_wahana selalu valid
    ID_wahana = input("Masukkan ID wahana: ")
    amount_ticket = int(input("Jumlah tiket yang di-refund: "))

    #Validasi ketersediaan tiket user
    found = False
    for i in range (len(arr_tiket)) :
        if ((arr_tiket[i][0] == username) and (arr_tiket[i][1] == ID_wahana)) :
            if (int(arr_tiket[i][2]) >= amount_ticket) :
                found = True
                index_tiket = i
                break
    #Mencari indeks pada array wahana
    for i in range (len(arr_wahana)) :
        if (arr_wahana[i][0] == ID_wahana) :
            index_wahana = i
            break
    #Mencari indeks pada array user
    for i in range (len(arr_user)) :
        if (arr_user[i][3] == username) :
            index_user = i
            break
    #Terminasi
    if (not found) :
        print("Anda tidak memiliki tiket terkait.")
    else : #found
        #Menghitung sisa tiket
        arr_tiket[index_tiket][2] = int(arr_tiket[index_tiket][2]) - amount_ticket
        #Menghitung saldo akhir
        arr_user[index_user][6] = int(arr_user[index_user][6]) + 0.75*amount_ticket*int(arr_wahana[index_wahana][2])
        #Mengembalikan input pada array global
        new_data = [username,tanggal,ID_wahana,amount_ticket]
        arr_refund.append(new_data)
        print("Uang refund sudah kami berikan pada akun Anda.")
    return()

#prosedur kritik dan saran
def kritiksaran(username ,arr_kritiksaran) :
    #Asumsi ID Wahana, tanggal pelaporan selalu valid
    ID_wahana = input("Masukkan ID Wahana :")
    tanggal = input("Masukkan tanggal pelaporan (DD/MM/YYYY): ")
    isi_kritik = input("Kritik/saran Anda: ")
    #Terminasi
    new_data = [username, tanggal, ID_wahana, isi_kritik]
    arr_kritiksaran.append(new_data)
    return()
    
#fungsi exit (keluar dari program)    
def exit(arr_user, arr_pembelian, arr_penggunaan, arr_tiket, arr_refund, arr_kritiksaran, arr_wahana) :
	save = input("Apakah anda mau melakukan penyimpanan file yang sudah dilakukan (Y/N) ? ")
	if (save == "Y") :
		save_file(arr_user)
		save_file(arr_pembelian)
		save_file(arr_penggunaan)
		save_file(arr_tiket)
		save_file(arr_refund)
		save_file(arr_kritiksaran)
		save_file(arr_wahana)
	return(True)










#End of bagian Bona



